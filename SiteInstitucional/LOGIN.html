<!DOCTYPE html>
<html lang="ptbr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOGIN</title>
    <link rel="stylesheet" href='styleCadastroLogin.css'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
        rel="stylesheet">
</head>
</head>

<body>
    <div class="login">
        <div class="esquerda1">
            <div class="nome"><a class="ab" href="SiteInst.html">HardStock</a></div>
            <div class="banner"></div>
        </div>
        <div class="direita1">
            <div class="direita2"><b>Login</b>
                <a class="aa" href="CADASTRO.html">Cadastro</a>
            </div>
            <div class="bloco">
                E-mail:<input class="inputs" id="input_email" type="text"><br>
                Senha:<input class="inputs" id="input_senha" type="password"></div>
            <div class="lugar-btn2"><button onclick="entrar()" class="btn">Entrar</button></div>
        </div>
    </div>
</body>

</html>
<script>

    function entrar() {

        // var nomeVar = b_usuario;
        var emailVar = input_email.value;
        var senhaVar = input_senha.value;
        var carac_email = email.indexOf('@')

        if (emailVar == "" || senhaVar == "") {
            cardErro.style.display = "block"
            mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
            // finalizarAguardar();
            return false;
        }
            

        if (emailVar == '') {

            alert('Digite seu email')

        } 
        if (senhaVar == '') {

            alert('Digite sua senha')

        }


        if (carac_email == -1) {

            alert('E-mail inválido')
            return false
        }

        else if (senhaVar.length < 8) {
            alert('Senha inválida')
            return false
        }

        window.location.href = "Dashboard.html"
        return true


    }
    // else {
    //     setInterval(sumirMensagem, 5000)
    // }

    console.log("FORM LOGIN: ", emailVar);
    console.log("FORM SENHA: ", senhaVar);

    fetch("/usuarios/autenticar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            // nomeServer: nomeVar,
            emailServer: emailVar,
            senhaServer: senhaVar
        })
    }).then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!")

        if (resposta.ok) {
            console.log(resposta);

            resposta.json().then(json => {
                console.log(json);
                console.log(JSON.stringify(json));
                sessionStorage.EMAIL_USUARIO = json.email;
                sessionStorage.NOME_USUARIO = json.nome;
                sessionStorage.ID_USUARIO = json.id;
                // sessionStorage.AQUARIOS = JSON.stringify(json.aquarios)

                setTimeout(function () {
                    window.location = "./dashboard/cards.html";
                }, 1000); // apenas para exibir o loading

            });

        } else {

            console.log("Houve um erro ao tentar realizar o login!");

            resposta.text().then(texto => {
                console.error(texto);
                // finalizarAguardar(texto);
            });
        }

    }).catch(function (erro) {
        console.log(erro);
    })

    return false;


    function sumirMensagem() {
        //  cardErro.style.display = "none"
    }

</script>



</script>